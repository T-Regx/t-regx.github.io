"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1065],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,h=d["".concat(l,".").concat(m)]||d[m]||c[m]||o;return n?a.createElement(h,i(i({ref:t},s),{},{components:n})):a.createElement(h,i({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var u=2;u<o;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5836:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c,frontMatter:()=>p,metadata:()=>l,toc:()=>u});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],p={id:"handling-user-input",title:"Handling user input"},l={unversionedId:"handling-user-input",id:"handling-user-input",isDocsHomePage:!1,title:"Handling user input",description:"Prepared Patterns allow you to confidently use user-input or unsafe data that might contain regular expression special characters. It's also",source:"@site/../docs/handling-user-input.md",sourceDirName:".",slug:"/handling-user-input",permalink:"/docs/handling-user-input",version:"current",lastUpdatedAt:1667226520,formattedLastUpdatedAt:"10/31/2022",frontMatter:{id:"handling-user-input",title:"Handling user input"},sidebar:"docs",previous:{title:"Replace with callback",permalink:"/docs/replace-callback"},next:{title:"Prepared Patterns",permalink:"/docs/prepared-patterns"}},u=[{value:"Why handling user input is important",id:"why-handling-user-input-is-important",children:[]},{value:"Why not just preg_quote()",id:"why-not-just-preg_quote",children:[]}],s={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Prepared Patterns allow you to confidently use user-input or unsafe data that might contain regular expression special characters. It's also\nintegrated with ",(0,o.kt)("a",{parentName:"p",href:"/docs/delimiters"},"Automatic Delimiters"),", so they're quoted with regard to the delimiter that was chosen automatically for\nyou."),(0,o.kt)("p",null,"You can either use ",(0,o.kt)("inlineCode",{parentName:"p"},"Pattern::template()")," which is a fully-fledged prepared pattern builder, or you can settle\nfor easy and quick ",(0,o.kt)("a",{parentName:"p",href:"/docs/prepared-patterns#with-patterninject"},(0,o.kt)("inlineCode",{parentName:"a"},"Pattern::inject()")),"."),(0,o.kt)("p",null,"You can read about each of them in the next section, but for now, let's cover the basics."),(0,o.kt)("h2",{id:"why-handling-user-input-is-important"},"Why handling user input is important"),(0,o.kt)("p",null,"Let's say, you would like to search a subject for ",(0,o.kt)("inlineCode",{parentName:"p"},'"My dog\'s name is Barky"'),", where the dog's name is user input.\nMaybe you created a web application which allows anyone to search their dogs."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"$input = $_GET['name'];\n\nPattern::of(\"(My|Our) dog's name is \" . $input . '!');\n")),(0,o.kt)("p",null,"Immediately though, you can see that ",(0,o.kt)("inlineCode",{parentName:"p"},"$input")," may contain ",(0,o.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/reference.pcre.pattern.syntax.php"},"special characters")," (like ",(0,o.kt)("inlineCode",{parentName:"p"},"."),", ",(0,o.kt)("inlineCode",{parentName:"p"},"?"),") that might interfere with your pattern. It also\nposes a threat to ReDOS attack, if the unsafe values aren't handled properly. More over, someone might actually try\nto be malicious by hand and might want to deliberate break your pattern."),(0,o.kt)("p",null,"For example, given query param ",(0,o.kt)("inlineCode",{parentName:"p"},"?name=(Barky!"),", this is what the pattern might end up looking:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},'Pattern::of("(My|Our) dog\'s name is (Barky!");\n')),(0,o.kt)("p",null,"If, by accident, ",(0,o.kt)("inlineCode",{parentName:"p"},"$input")," had a value of ",(0,o.kt)("inlineCode",{parentName:"p"},"B(arky")," - you would receive an exception ",(0,o.kt)("inlineCode",{parentName:"p"},"missing ) at offset 31"),", but that's\nnot everything. If you simply try to use malformed patterns, T-Regx throws and exception and you're done.\nHowever, with access to injecting malicious expressions, other, more harmful structures can be added, for example:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Complex look-aheads and look-arounds (",(0,o.kt)("inlineCode",{parentName:"li"},"(?!<"),")"),(0,o.kt)("li",{parentName:"ul"},"Recursive patterns (",(0,o.kt)("inlineCode",{parentName:"li"},"(?R)"),")"),(0,o.kt)("li",{parentName:"ul"},"Structures prone to catastrophic backtracking")),(0,o.kt)("p",null,"Such harmful structures can realistically pose ReDos attacks treats to your application and your server."),(0,o.kt)("p",null,"Read on, to learn about proper handling of user input."),(0,o.kt)("h2",{id:"why-not-just-preg_quote"},"Why not just ",(0,o.kt)("a",{parentName:"h2",href:"https://www.php.net/manual/en/function.preg-quote.php"},(0,o.kt)("inlineCode",{parentName:"a"},"preg_quote()"))),(0,o.kt)("p",null,"Good question."),(0,o.kt)("p",null,"The same reason why good programmers use Prepared SQL Statements, instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"mysql_real_escape_string()"),". They allow you to separate\nregular expression from unsafe data, which helps with making the pattern safer:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"it's ",(0,o.kt)("em",{parentName:"li"},"declarative"),", means you only need to ",(0,o.kt)("em",{parentName:"li"},"declare")," how would you like the data to be used."),(0,o.kt)("li",{parentName:"ul"},"delimiters become an implementation detail - one less thing to worry about."),(0,o.kt)("li",{parentName:"ul"},"Extended mode (e.g. with ",(0,o.kt)("a",{parentName:"li",href:"https://www.php.net/manual/en/reference.pcre.pattern.modifiers.php"},(0,o.kt)("inlineCode",{parentName:"a"},"x"))," flag, or in-pattern construct) require spaces and whitespaces to also be quoted, which ",(0,o.kt)("a",{parentName:"li",href:"https://www.php.net/manual/en/function.preg-quote.php"},(0,o.kt)("inlineCode",{parentName:"a"},"preg_quote()")),"\ndoesn't quote at all!"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.php.net/manual/en/function.preg-quote.php"},(0,o.kt)("inlineCode",{parentName:"a"},"preg_quote()"))," doesn't quote comments in PHP 7.1 and before, in T-Regx this is handled on all PHP versions.")))}c.isMDXComponent=!0}}]);