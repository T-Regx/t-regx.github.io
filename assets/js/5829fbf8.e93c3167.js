"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4508],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),s=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(n),m=r,h=c["".concat(o,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(h,p(p({ref:t},d),{},{components:n})):a.createElement(h,p({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,p=new Array(i);p[0]=c;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,p[1]=l;for(var s=2;s<i;s++)p[s]=n[s];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},6573:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),p=["components"],l={id:"prepared-patterns",title:"Prepared Patterns",sidebar_label:"Prepared Patterns - User input"},o={unversionedId:"prepared-patterns",id:"prepared-patterns",isDocsHomePage:!1,title:"Prepared Patterns",description:"If you use [Pattern::template(), you can explicitly specify which parts of your pattern",source:"@site/../docs/prepared-patterns.md",sourceDirName:".",slug:"/prepared-patterns",permalink:"/docs/prepared-patterns",version:"current",lastUpdatedAt:1663931802,formattedLastUpdatedAt:"9/23/2022",sidebar_label:"Prepared Patterns - User input",frontMatter:{id:"prepared-patterns",title:"Prepared Patterns",sidebar_label:"Prepared Patterns - User input"},sidebar:"docs",previous:{title:"Handling user input",permalink:"/docs/handling-user-input"},next:{title:"Multiple patterns",permalink:"/docs/pattern-list"}},s=[{value:"Use-case",id:"use-case",children:[{value:"With <code>Pattern::inject()</code>",id:"with-patterninject",children:[]}]},{value:"PCRE modifiers",id:"pcre-modifiers",children:[]},{value:"PCRE-styled patterns",id:"pcre-styled-patterns",children:[]},{value:"Old-school pattern quoting",id:"old-school-pattern-quoting",children:[]}],d={toc:s};function u(e){var t=e.components,n=(0,r.Z)(e,p);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"If you use ",(0,i.kt)("a",{parentName:"p",href:"/docs/prepared-patterns#with-patterninject"},(0,i.kt)("inlineCode",{parentName:"a"},"Pattern::inject()"))," or ",(0,i.kt)("inlineCode",{parentName:"p"},"Pattern::template()"),", you can explicitly specify which parts of your pattern\nshould be treated as string literals, and not as regular expression special characters."),(0,i.kt)("p",null,"Prepared Patterns also understand that strings, that are supposed to be treated as string literals, are to be\nquoted with a delimiter, that was chosen with ",(0,i.kt)("a",{parentName:"p",href:"/docs/delimiters"},"Automatic Delimiters"),"."),(0,i.kt)("h2",{id:"use-case"},"Use-case"),(0,i.kt)("p",null,"When you need to use unsafe data in your patterns, it might be tempting to do something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"// build the pattern\n$pattern = Pattern::of('^https://' . $_GET['domain'] . '\\.(com|net)');\n\n// use the pattern\n$pattern->test($string);\n")),(0,i.kt)("p",null,"But you, dear reader, know that it's a terrible, terrible idea. ",(0,i.kt)("inlineCode",{parentName:"p"},"$_GET['domain']")," may contain\nunexpected/malicious regular expression characters."),(0,i.kt)("p",null,"We need to treat each part of that pattern separately, we must:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"^https://")," must be treated ",(0,i.kt)("strong",{parentName:"li"},"as a regular expression")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$_GET['domain']")," must be treated ",(0,i.kt)("strong",{parentName:"li"},"as a string")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"\\.(com|net)")," must be treated ",(0,i.kt)("strong",{parentName:"li"},"as a regular expression")," ")),(0,i.kt)("h3",{id:"with-patterninject"},"With ",(0,i.kt)("inlineCode",{parentName:"h3"},"Pattern::inject()")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Pattern::inject()")," allows you to specify ",(0,i.kt)("inlineCode",{parentName:"p"},"@")," placeholder in your pattern, in which\nyour value will be ",(0,i.kt)("strong",{parentName:"p"},"safely")," injected."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"$pattern = Pattern::inject(\"https?://@/index\\.php\", [$_GET['domain']]);\n\n$pattern->test($string);\n")),(0,i.kt)("p",null,"The code above means:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Treat ",(0,i.kt)("inlineCode",{parentName:"li"},"https?://")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"/index\\.php")," as regexp"),(0,i.kt)("li",{parentName:"ul"},"Replace ",(0,i.kt)("inlineCode",{parentName:"li"},"@")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"$_GET['domain']"),", but handling all regexp special characters.")),(0,i.kt)("h2",{id:"pcre-modifiers"},"PCRE modifiers"),(0,i.kt)("p",null,"Should there be a need for additional PCRE modifiers (flags), simply pass them as a last argument into prepared patterns."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},'Pattern::inject("https?://@/index\\.php", [$_GET["domain"]], \'mS\');\n')),(0,i.kt)("h2",{id:"pcre-styled-patterns"},"PCRE-styled patterns"),(0,i.kt)("p",null,"Should there be a need for your own delimiters, or you just want to use PCRE style, simply use\n",(0,i.kt)("inlineCode",{parentName:"p"},"PcrePattern::"),", instead of ",(0,i.kt)("inlineCode",{parentName:"p"},"Pattern::"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},'PcrePattern::inject("/https?://@/index\\.php/m", [$_GET["domain"]], \'S\');\n')),(0,i.kt)("h2",{id:"old-school-pattern-quoting"},"Old-school pattern quoting"),(0,i.kt)("p",null,"Have you chosen to work with regular PCRE functions, your code might look similar to this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"preg_match('/(Pattern|pattern) with ' . preg_quote('quoted parts...', '/') . ' is ugly/');\n")),(0,i.kt)("p",null,"Prepared Patterns address some of this approach flaws. They:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"automatically delimiter your input, so there's no need for specifying the delimiter again in ",(0,i.kt)("a",{parentName:"li",href:"https://www.php.net/manual/en/function.preg-quote.php"},(0,i.kt)("inlineCode",{parentName:"a"},"preg_quote()")),"."),(0,i.kt)("li",{parentName:"ul"},"are declarative. Meaning, you only need to ",(0,i.kt)("em",{parentName:"li"},"declare")," that you want those values to be treated as string literals."),(0,i.kt)("li",{parentName:"ul"},"fix inconsistency with ",(0,i.kt)("a",{parentName:"li",href:"https://www.php.net/manual/en/function.preg-quote.php"},(0,i.kt)("inlineCode",{parentName:"a"},"preg_quote()"))," quoting different values since PHP 7.3")),(0,i.kt)("p",null,"They also add additional functionality, that currently is utterly missing in PHP:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Extended mode (enabled e.g. with ",(0,i.kt)("a",{parentName:"li",href:"https://www.php.net/manual/en/reference.pcre.pattern.modifiers.php"},(0,i.kt)("inlineCode",{parentName:"a"},"x"))," flag) ignores whitespaces, so large expressions can be split to multiple lines. ",(0,i.kt)("a",{parentName:"li",href:"https://www.php.net/manual/en/function.preg-quote.php"},(0,i.kt)("inlineCode",{parentName:"a"},"preg_quote()")),"\ndoesn't quote spaces, so user-input spaces are also going to be ignored - Prepared Patterns will however preserve them.")),(0,i.kt)("h1",{id:"what-about-special-cases"},"What about special cases"),(0,i.kt)("p",null,"T-Regx prepared patterns understand that sometimes ",(0,i.kt)("inlineCode",{parentName:"p"},'"@"')," placeholder shouldn't be treated as a placeholder, even\nwhen using ",(0,i.kt)("a",{parentName:"p",href:"/docs/prepared-patterns#with-patterninject"},(0,i.kt)("inlineCode",{parentName:"a"},"Pattern::inject()")),"/",(0,i.kt)("inlineCode",{parentName:"p"},"Pattern::template()"),". These cases are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Character class: ",(0,i.kt)("inlineCode",{parentName:"li"},"\\w+:[0-9@]")),(0,i.kt)("li",{parentName:"ul"},"Perl quote: ",(0,i.kt)("inlineCode",{parentName:"li"},"\\w+:\\Q@\\E")),(0,i.kt)("li",{parentName:"ul"},"Control character: ",(0,i.kt)("inlineCode",{parentName:"li"},"\\w+:\\c@")),(0,i.kt)("li",{parentName:"ul"},"Comment (when ",(0,i.kt)("inlineCode",{parentName:"li"},"x")," flag is used): ",(0,i.kt)("inlineCode",{parentName:"li"},"\\w+:#@\\n"))),(0,i.kt)("p",null,"When ",(0,i.kt)("inlineCode",{parentName:"p"},"@")," appears in one of those fragments, it won't be treated as a placeholder, and values won't be injected into it."))}u.isMDXComponent=!0}}]);